#!/bin/sh
test -f version.h || exit 1
rm -f Makefile
for MODUL in generate runform runform/colquery runform/regex runform/elk runform/crypt; do
  ( cd $MODUL; make clean; ) >/dev/null
done
test "$1" = "clean" && exit
cat >Makefile <<EOF
ARX=/opt/arx
all: runform/runform generate/adjfield
	@echo 'you can now run "sudo make install"'
install: all \$(DESTDIR)\$(ARX)/bin
	@cp -vp generate/makeform generate/editform generate/adjfield generate/extractsql runform/runform \$(DESTDIR)\$(ARX)/bin
	@cp -vp generate/arx.sh generate/formax.frm \$(DESTDIR)\$(ARX)/lib
	@cp -rp runform \$(DESTDIR)\$(ARX)
	@if [ -d \$(DESTDIR)/etc/profile.d ]; then cp -vp generate/arx.sh \$(DESTDIR)/etc/profile.d; else true; fi
\$(DESTDIR)\$(ARX)/bin:
	@for D in bin lib; do mkdir -p \$(DESTDIR)\$(ARX)/\$\$D; done
generate/adjfield:
	cd generate; make
runform/runform:
	cd runform; make
clean:
	./configure clean
EOF
echo 'you can now run "make"' >&2
exit
