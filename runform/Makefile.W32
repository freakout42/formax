CC=gcc
SRCS=$(wildcard *.cpp)
OBJS=$(patsubst %.cpp,%.o,$(SRCS))
OBJB=cqerror.o colquery/colquery.o elk/elk.o regex/re.o
CXXFLAGS=-DPURUNFORM -DNCURSES_STATIC -Iinclude -Iinclude/ncursesw

all: runform

$(OBJS): runform.h
runform.h: company.h curkeys.h
company.h: arx.h
	cp arx.h $@

runform: $(OBJS) $(OBJB)
	$(CXX) $(OBJS) $(OBJB) lib/libncursesw.dll.a -lodbc32 -o $@

curkeys.h: curkeys.c
	$(CC) $(CXXFLAGS) curkeys.c -o curkeys.exe
	./curkeys.exe >$@

colquery/colquery.o:
	cd colquery; make colquery.o CC=gcc

clean:
	rm -f *.o runform $(OBJB)
	for SUB in colquery elk regex; do cd $$SUB; make clean CC=gcc; cd ..; done

libncursesw6.dll:
	unzip ../bin/ncurses-win32.zip
	cp bin/libncursesw6.dll .

# wget -O../bin/ncurses-win32.zip https://invisible-island.net/datafiles/release/mingw32.zip
# compile with msys + mingw32
